import React, { useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { cn } from '@/lib/utils';

const CricketUmpiringApp = () => {
  const [teams, setTeams] = useState([
    { name: '', players: [] },
    { name: '', players: [] }
  ]);
  const [currentTeam, setCurrentTeam] = useState(0);
  const [currentOver, setCurrentOver] = useState([]);
  const [score, setScore] = useState([0, 0]);
  const [wickets, setWickets] = useState([0, 0]);
  const [playerName, setPlayerName] = useState('');
  const [teamNames, setTeamNames] = useState(['Team A', 'Team B']);
  const [teamNameInputs, setTeamNameInputs] = useState(['', '']);

  const addPlayer = () => {
    const updatedTeams = [...teams];
    if (updatedTeams[currentTeam].players.length < 11) {
      updatedTeams[currentTeam].players.push({ name: playerName, runs: 0, balls: 0, out: false });
      setTeams(updatedTeams);
      setPlayerName('');
    }
  };

  const recordRun = (runs, type = 'normal') => {
    const updatedScore = [...score];
    if (type === 'normal' || type === 'bye' || type === 'legbye') {
      updatedScore[currentTeam] += runs;
    } else if (type === 'wide' || type === 'noball') {
      updatedScore[currentTeam] += 1;
    }
    setScore(updatedScore);

    const updatedTeams = [...teams];
    const striker = updatedTeams[currentTeam].players.find(p => !p.out);
    if (striker && type === 'normal') {
      striker.runs += runs;
      striker.balls += 1;
    } else if (striker && (type === 'bye' || type === 'legbye')) {
      striker.balls += 1;
    }
    setTeams(updatedTeams);

    setCurrentOver([...currentOver, type === 'normal' ? runs : type.toUpperCase()]);
  };

  const recordWicket = () => {
    const updatedWickets = [...wickets];
    updatedWickets[currentTeam] += 1;
    setWickets(updatedWickets);

    const updatedTeams = [...teams];
    const striker = updatedTeams[currentTeam].players.find(p => !p.out);
    if (striker) striker.out = true;
    setTeams(updatedTeams);

    setCurrentOver([...currentOver, 'W']);
  };

  const switchTeam = () => {
    setCurrentTeam(currentTeam === 0 ? 1 : 0);
    setCurrentOver([]);
  };

  const setTeamName = (index, name) => {
    const updated = [...teamNameInputs];
    updated[index] = name;
    setTeamNameInputs(updated);

    const updatedTeams = [...teams];
    updatedTeams[index].name = name;
    setTeams(updatedTeams);
    setTeamNames([updatedTeams[0].name, updatedTeams[1].name]);
  };

  return (
    <div 
      className="p-6 space-y-6 max-w-4xl mx-auto min-h-screen bg-cover bg-center" 
      style={{ backgroundImage: 'url("/mnt/data/4bdef79c31762dae3f00649a4c93556f.jpg")' }}
    >
      <Card className="p-4 bg-white bg-opacity-90">
        <CardContent className="space-y-4">
          <div className="flex gap-4">
            {[0, 1].map(i => (
              <div key={i} className="flex flex-col space-y-2 w-1/2">
                <Input
                  value={teamNameInputs[i]}
                  onChange={(e) => setTeamName(i, e.target.value)}
                  placeholder={`Enter Team ${i + 1} Name`}
                />
              </div>
            ))}
          </div>
        </CardContent>
      </Card>

      <Card className="p-4 bg-white bg-opacity-90">
        <CardContent className="space-y-4">
          <h2 className="text-2xl font-bold text-center text-blue-700">{teamNames[currentTeam] || `Team ${currentTeam + 1}`}</h2>
          <div className="text-center font-medium text-lg">Score: {score[currentTeam]} / {wickets[currentTeam]}</div>
          <div className="text-center text-gray-600">Over: {currentOver.join(', ')}</div>

          <div className="grid grid-cols-3 gap-2 mt-4">
            {[1, 2, 4, 6].map(r => (
              <Button key={r} onClick={() => recordRun(r)}>{r} Run{r > 1 ? 's' : ''}</Button>
            ))}
            <Button variant="secondary" onClick={() => recordRun(0, 'wide')}>Wide</Button>
            <Button variant="secondary" onClick={() => recordRun(0, 'noball')}>No Ball</Button>
            <Button variant="secondary" onClick={() => recordRun(1, 'bye')}>Bye</Button>
            <Button variant="secondary" onClick={() => recordRun(1, 'legbye')}>Leg Bye</Button>
            <Button variant="destructive" onClick={recordWicket}>Wicket</Button>
          </div>

          <Button className="w-full mt-4" onClick={switchTeam}>Switch to {teamNames[currentTeam === 0 ? 1 : 0] || `Team ${currentTeam === 0 ? 2 : 1}`}</Button>
        </CardContent>
      </Card>

      <Card className="p-4 bg-white bg-opacity-90">
        <CardContent className="space-y-2">
          <h3 className="text-lg font-semibold">Add Player to {teamNames[currentTeam] || `Team ${currentTeam + 1}`}</h3>
          <div className="flex gap-2">
            <Input value={playerName} onChange={(e) => setPlayerName(e.target.value)} placeholder="Player Name" />
            <Button onClick={addPlayer}>Add</Button>
          </div>
        </CardContent>
      </Card>

      <Card className="p-4 bg-white bg-opacity-90">
        <CardContent>
          <h3 className="text-lg font-semibold mb-2">Players</h3>
          <ul className="space-y-1">
            {teams[currentTeam].players.map((p, i) => (
              <li key={i} className="text-sm border-b pb-1">
                {p.name} - {p.runs} runs ({p.balls} balls) {p.out ? 'OUT' : 'NOT OUT'}
              </li>
            ))}
          </ul>
        </CardContent>
      </Card>
    </div>
  );
};

export default CricketUmpiringApp;
