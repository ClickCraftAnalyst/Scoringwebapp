<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cricket Scoring Web App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('your-bg.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      background-color: rgba(255,255,255,0.95);
      border-radius: 12px;
      margin-top: 20px;
    }
    h2, h3, h4 {
      text-align: center;
    }
    .team-section, .score-section, .players-section, .extras-section, .current-batsmen {
      margin-top: 20px;
    }
    .button-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    button {
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover:not(:disabled) {
      background-color: #0056b3;
      color: white;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    input {
      padding: 8px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
    }
    ul {
      list-style-type: none;
      padding: 0;
      max-height: 200px;
      overflow-y: auto;
    }
    li {
      padding: 6px 0;
      border-bottom: 1px solid #ddd;
      font-weight: normal;
    }
    li.out {
      color: red;
      text-decoration: line-through;
      font-weight: bold;
    }
    li.striker {
      font-weight: bold;
      color: green;
    }
    .extras-section p {
      margin: 4px 0;
      font-weight: bold;
    }
    .reset-button {
      background-color: #dc3545;
      color: white;
      margin-top: 15px;
      width: 100%;
    }
    .switch-button {
      background-color: #007BFF;
      color: white;
      margin-top: 15px;
      width: 100%;
    }
    .undo-clear-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
      gap: 10px;
    }
    .undo-clear-buttons button {
      flex: 1;
    }
    .overs-ballruns {
      text-align: center;
      margin-top: 10px;
      font-size: 18px;
      font-family: monospace;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Cricket Umpiring Web App</h2>

    <div class="team-section">
      <input id="team0" placeholder="Enter Team A Name" />
      <input id="team1" placeholder="Enter Team B Name" style="margin-top: 10px;" />
    </div>

    <div class="score-section">
      <h3 id="team-name">Team A</h3>
      <p><strong>Score:</strong> <span id="score">0</span> / <span id="wickets">0</span></p>
      <p><strong>Overs:</strong> <span id="over">0.0</span></p>
      <div class="overs-ballruns" id="balls-of-over"></div>
    </div>

    <div class="current-batsmen">
      <p><strong>Striker:</strong> <span id="striker-name">-</span></p>
      <p><strong>Non-Striker:</strong> <span id="non-striker-name">-</span></p>
    </div>

    <div class="extras-section">
      <p>Extras:</p>
      <p>Wides: <span id="wides">0</span></p>
      <p>No Balls: <span id="noBalls">0</span></p>
      <p>Byes: <span id="byes">0</span></p>
      <p>Leg Byes: <span id="legByes">0</span></p>
    </div>

    <div class="button-grid">
      <button onclick="recordRun(1)">1 Run</button>
      <button onclick="recordRun(2)">2 Runs</button>
      <button onclick="recordRun(4)">4 Runs</button>
      <button onclick="recordRun(6)">6 Runs</button>
      <button onclick="recordRun(0, 'wide')">Wide</button>
      <button onclick="recordRun(0, 'noball')">No Ball</button>
      <button onclick="recordRun(1, 'bye')">Bye</button>
      <button onclick="recordRun(1, 'legbye')">Leg Bye</button>
      <button onclick="recordWicket()">Wicket</button>
    </div>

    <div class="undo-clear-buttons">
      <button onclick="undoLastBall()">Undo Last Ball</button>
      <button onclick="clearInnings()">Clear Current Innings</button>
    </div>

    <button class="switch-button" onclick="switchTeam()">Switch Team</button>
    <button class="reset-button" onclick="resetMatch()">Reset Match</button>

    <div class="players-section">
      <h3>Add Player (Max 11 per team)</h3>
      <input id="playerName" placeholder="Player Name" />
      <button onclick="addPlayer()" style="margin-top: 10px;">Add Player</button>
      <h4>Players</h4>
      <ul id="playerList"></ul>
    </div>
  </div>

  <script>
    let teams = [
      { 
        name: 'Team A', 
        players: [], 
        score: 0, 
        wickets: 0, 
        overs: 0, // completed overs
        ballsInCurrentOver: 0,
        wides: 0,
        noBalls: 0,
        byes: 0,
        legByes: 0,
        balls: [] // all ball events (each ball as object)
      },
      { 
        name: 'Team B', 
        players: [], 
        score: 0, 
        wickets: 0, 
        overs: 0, 
        ballsInCurrentOver: 0,
        wides: 0,
        noBalls: 0,
        byes: 0,
        legByes: 0,
        balls: []
      }
    ];

    let currentTeam = 0;
    let strikerIndex = -1;
    let nonStrikerIndex = -1;

    document.getElementById('team0').addEventListener('input', e => {
      teams[0].name = e.target.value.trim() || 'Team A';
      if (currentTeam === 0) updateDisplay();
    });

    document.getElementById('team1').addEventListener('input', e => {
      teams[1].name = e.target.value.trim() || 'Team B';
      if (currentTeam === 1) updateDisplay();
    });

    function updateOversDisplay() {
      let t = teams[currentTeam];
      let oversText = `${t.overs}.${t.ballsInCurrentOver}`;
      document.getElementById('over').innerText = oversText;
      updateBallsOfOverDisplay();
    }

    function updateBallsOfOverDisplay() {
      let t = teams[currentTeam];
      // Show runs/events of balls in current over
      let balls = t.balls.slice(-t.ballsInCurrentOver); // last ballsInCurrentOver balls
      let displayStr = balls.map(ball => {
        switch(ball.type) {
          case 'normal': return ball.runs;
          case 'wide': return 'Wd';
          case 'noball': return 'Nb';
          case 'bye': return 'B';
          case 'legbye': return 'Lb';
          case 'wicket': return 'W';
          default: return '?';
        }
      }).join(' ');
      document.getElementById('balls-of-over').innerText = displayStr || '-';
    }

    function updateExtrasDisplay() {
      let t = teams[currentTeam];
      document.getElementById('wides').innerText = t.wides;
      document.getElementById('noBalls').innerText = t.noBalls;
      document.getElementById('byes').innerText = t.byes;
      document.getElementById('legByes').innerText = t.legByes;
    }

    function updateBatsmenDisplay() {
      let t = teams[currentTeam];
      const striker = strikerIndex >= 0 ? t.players[strikerIndex] : null;
      const nonStriker = nonStrikerIndex >= 0 ? t.players[nonStrikerIndex] : null;

      document.getElementById('striker-name').innerText = striker ? `${striker.name} (${striker.runs} runs, ${striker.balls} balls)` : '-';
      document.getElementById('non-striker-name').innerText = nonStriker ? `${nonStriker.name} (${nonStriker.runs} runs, ${nonStriker.balls} balls)` : '-';
    }

    function updateDisplay() {
      let t = teams[currentTeam];
      document.getElementById('team-name').innerText = t.name;
      document.getElementById('score').innerText = t.score;
      document.getElementById('wickets').innerText = t.wickets;
      updateOversDisplay();
      updateExtrasDisplay();
      updateBatsmenDisplay();

      let list = document.getElementById('playerList');
      list.innerHTML = '';
      t.players.forEach((p, idx) => {
        let li = document.createElement('li');
        li.textContent = `${p.name} - ${p.runs} runs (${p.balls} balls) ${p.out ? 'OUT' : 'NOT OUT'}`;
        if (p.out) li.classList.add('out');
        if (idx === strikerIndex) li.classList.add('striker');
        if (idx === nonStrikerIndex) li.classList.add('striker');
        list.appendChild(li);
      });

      // Disable scoring buttons if no players or not enough players
      let buttons = document.querySelectorAll('.button-grid button');
      if (teams[currentTeam].players.length < 2) {
        buttons.forEach(b => b.disabled = true);
      } else {
        buttons.forEach(b => b.disabled = false);
      }
    }

    function addPlayer() {
      let name = document.getElementById('playerName').value.trim();
      let t = teams[currentTeam];
      if (!name) {
        alert("Player name cannot be empty.");
        return;
      }
      if (t.players.length >= 11) {
        alert("Maximum 11 players allowed per team.");
        return;
      }
      t.players.push({ name, runs: 0, balls: 0, out: false });
      document.getElementById('playerName').value = '';

      if (t.players.length === 1) {
        strikerIndex = 0;
        nonStrikerIndex = -1;
      } else if (t.players.length === 2 && nonStrikerIndex === -1) {
        nonStrikerIndex = 1;
      }

      updateDisplay();
    }

    function rotateStrike() {
      [strikerIndex, nonStrikerIndex] = [nonStrikerIndex, strikerIndex];
    }

    function nextBatsman() {
      let t = teams[currentTeam];
      for (let i = 0; i < t.players.length; i++) {
        if (!t.players[i].out && i !== strikerIndex && i !== nonStrikerIndex) {
          return i;
        }
      }
      return -1;
    }

    function recordRun(runs, type = 'normal') {
      let t = teams[currentTeam];

      // Ensure 2 players minimum to proceed
      if (t.players.length < 2) {
        alert("Add at least 2 players before scoring.");
        return;
      }

      // On wides and no balls - ball does not count (no ball count increase)
      if (type === 'wide') {
        t.score += 1;
        t.wides += 1;
        t.balls.push({type: 'wide', runs: 1});
        // No ball increment or strike rotation on wides
      } else if (type === 'noball') {
        t.score += 1;
        t.noBalls += 1;
        t.balls.push({type: 'noball', runs: 1});
        // No ball increment or strike rotation on no balls
      } else {
        // Legal ball - increment ballsInCurrentOver
        t.ballsInCurrentOver++;
        // Push ball with run details
        t.balls.push({type: type === 'normal' ? 'normal' : type, runs: runs});
        
        // Update score accordingly
        if (type === 'normal') {
          t.score += runs;
          // Update striker stats
          let striker = t.players[strikerIndex];
          striker.runs += runs;
          striker.balls++;
        } else if (type === 'bye') {
          t.score += runs;
          t.byes += runs;
        } else if (type === 'legbye') {
          t.score += runs;
          t.legByes += runs;
        }

        // Rotate strike if runs odd on normal or bye/legbye
        if (runs % 2 === 1) {
          rotateStrike();
        }

        // Check if over is completed
        if (t.ballsInCurrentOver === 6) {
          t.overs++;
          t.ballsInCurrentOver = 0;
          rotateStrike();
        }
      }

      updateDisplay();
    }

    function recordWicket() {
      let t = teams[currentTeam];

      if (t.players.length < 2) {
        alert("Add at least 2 players before recording a wicket.");
        return;
      }

      // Ball counted
      t.ballsInCurrentOver++;
      t.balls.push({type: 'wicket', runs: 0});
      
      // Mark striker out
      t.players[strikerIndex].out = true;
      t.players[strikerIndex].balls++;
      t.wickets++;

      // Find next batsman
      let nextBatsmanIndex = nextBatsman();
      if (nextBatsmanIndex === -1) {
        alert("All players out or no new batsman available.");
        // End innings or match logic here if needed
      } else {
        strikerIndex = nextBatsmanIndex;
      }

      // Over complete check
      if (t.ballsInCurrentOver === 6) {
        t.overs++;
        t.ballsInCurrentOver = 0;
        rotateStrike();
      }

      updateDisplay();
    }

    function switchTeam() {
      currentTeam = currentTeam === 0 ? 1 : 0;
      strikerIndex = teams[currentTeam].players.length >= 1 ? 0 : -1;
      nonStrikerIndex = teams[currentTeam].players.length >= 2 ? 1 : -1;
      updateDisplay();
    }

    function resetMatch() {
      teams = [
        { name: 'Team A', players: [], score: 0, wickets: 0, overs: 0, ballsInCurrentOver: 0, wides: 0, noBalls: 0, byes: 0, legByes: 0, balls: [] },
        { name: 'Team B', players: [], score: 0, wickets: 0, overs: 0, ballsInCurrentOver: 0, wides: 0, noBalls: 0, byes: 0, legByes: 0, balls: [] }
      ];
      currentTeam = 0;
      strikerIndex = -1;
      nonStrikerIndex = -1;
      document.getElementById('team0').value = 'Team A';
      document.getElementById('team1').value = 'Team B';
      updateDisplay();
    }

    function clearInnings() {
      let t = teams[currentTeam];
      t.score = 0;
      t.wickets = 0;
      t.overs = 0;
      t.ballsInCurrentOver = 0;
      t.wides = 0;
      t.noBalls = 0;
      t.byes = 0;
      t.legByes = 0;
      t.balls = [];
      // Reset players runs, balls and out status but keep players
      t.players.forEach(p => {
        p.runs = 0;
        p.balls = 0;
        p.out = false;
      });
      strikerIndex = t.players.length >= 1 ? 0 : -1;
      nonStrikerIndex = t.players.length >= 2 ? 1 : -1;
      updateDisplay();
    }

    function undoLastBall() {
      let t = teams[currentTeam];
      if (t.balls.length === 0) {
        alert("No balls to undo!");
        return;
      }

      let lastBall = t.balls.pop();

      // Undo logic depends on ball type
      switch(lastBall.type) {
        case 'wide':
          t.score -= 1;
          t.wides--;
          // No ball increment, no strike change
          break;
        case 'noball':
          t.score -= 1;
          t.noBalls--;
          break;
        case 'bye':
          t.score -= lastBall.runs;
          t.byes -= lastBall.runs;
          t.ballsInCurrentOver--;
          break;
        case 'legbye':
          t.score -= lastBall.runs;
          t.legByes -= lastBall.runs;
          t.ballsInCurrentOver--;
          break;
        case 'normal':
          t.score -= lastBall.runs;
          // Remove runs from striker
          if (strikerIndex >= 0 && t.players[strikerIndex]) {
            t.players[strikerIndex].runs -= lastBall.runs;
            t.players[strikerIndex].balls--;
          }
          t.ballsInCurrentOver--;
          break;
        case 'wicket':
          // Undo wicket
          t.wickets--;
          t.ballsInCurrentOver--;
          // Undo striker out - mark last out player NOT out
          // Assume last wicket was striker (correct in recordWicket)
          // Find last player marked out:
          let lastOutPlayerIndex = t.players.findIndex(p => p.out);
          if (lastOutPlayerIndex === -1) {
            // If none found, assume strikerIndex was out
            lastOutPlayerIndex = strikerIndex;
          }
          if (lastOutPlayerIndex !== -1) {
            t.players[lastOutPlayerIndex].out = false;
            t.players[lastOutPlayerIndex].balls--;
            strikerIndex = lastOutPlayerIndex;
          }
          break;
      }

      // Recalculate overs and ballsInCurrentOver if needed
      if (t.ballsInCurrentOver < 0) {
        if (t.overs > 0) {
          t.overs--;
          t.ballsInCurrentOver = 5;
        } else {
          t.ballsInCurrentOver = 0;
        }
      }

      // After undo, recalc overs based on total legal balls
      // Legal balls exclude wides and no balls
      let legalBallsCount = t.balls.filter(b => b.type !== 'wide' && b.type !== 'noball').length;
      t.overs = Math.floor(legalBallsCount / 6);
      t.ballsInCurrentOver = legalBallsCount % 6;

      updateDisplay();
    }

    updateDisplay();
  </script>
</body>
</html>
